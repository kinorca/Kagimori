kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
name: kmsv2-test-cluster
nodes:
  - role: control-plane
    extraMounts:
      - hostPath: /tmp/kagimori.sock
        containerPath: /tmp/kagimori.sock
      - hostPath: ./encryption-config.yaml
        containerPath: /etc/kubernetes/encryption-config.yaml
    kubeadmConfigPatches:
      - |
        apiVersion: kubeadm.k8s.io/v1beta4
        kind: ClusterConfiguration
        apiServer:
          extraArgs:
            encryption-provider-config: /etc/kubernetes/encryption-config.yaml
          extraVolumes:
            - name: socket-kmsv2-kagimori
              hostPath: /tmp/kagimori.sock
              mountPath: /tmp/kagimori.sock
              pathType: File
            - name: encryption-config
              hostPath: /etc/kubernetes/encryption-config.yaml
              mountPath: /etc/kubernetes/encryption-config.yaml
              pathType: File
              readOnly: true
