apiVersion: kubeadm.k8s.io/v1beta3
kind: ClusterConfiguration
apiServer:
  extraArgs:
    encryption-provider-config: /etc/kubernetes/encryption-config.yaml
  extraVolumes:
    - name: socket-kagimori
      hostPath: /var/run/kagimori
      mountPath: /var/run/kagimori
      pathType: Directory
podSpecs:
  - name: kagimori-kms
    image: ghcr.io/kinorca/kagimori:latest
    command:
      - /usr/local/bin/kagimori
      - --listen=unix:///var/run/kagimori/kagimori.sock
      - --kms-v2
      - --master-key=/etc/kagimori/keys/master-key.yaml
    volumeMounts:
      - name: socket-kagimori
        hostPath: /var/run/kagimori
        mountPath: /var/run/kagimori
        pathType: Directory
